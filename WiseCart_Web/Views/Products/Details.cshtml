@model WiseCart_Web.Models.Product

@{
    ViewData["Title"] = "ÃœrÃ¼n DetayÄ± - " + Model.Name;
}

<div class="container mt-5">
    <div class="card shadow-lg border-0">
        <div class="row g-0">
            <div class="col-md-5 bg-light d-flex align-items-center justify-content-center p-3">
                <img src="@(string.IsNullOrEmpty(Model.ImageUrl) ? "https://via.placeholder.com/500x500?text=Urun+Resmi" : Model.ImageUrl)" 
                     class="img-fluid rounded" alt="@Model.Name" style="max-height: 400px;">
            </div>
            
            <div class="col-md-7">
                <div class="card-body p-5">
                    <h2 class="card-title fw-bold text-dark">@Model.Name</h2>
                    <hr>
                    
                    <div class="mb-4">
                        <span class="badge bg-primary fs-6">@Model.Category?.Name</span>
                        <span class="badge bg-secondary fs-6">@Model.Brand?.Name</span>
                        <span class="badge bg-warning text-dark fs-6">â­ @Model.ReviewCount Yorum</span>
                    </div>

                    <h1 class="display-5 text-success fw-bold mb-4">
                        @Model.CurrentPrice?.ToString("N0") TL
                    </h1>

                    <div class="d-grid gap-2">
                        <a href="@Model.Url" target="_blank" class="btn btn-outline-dark btn-lg">
                            ğŸŒ SatÄ±cÄ±ya Git (N11)
                        </a>
                        
                        <button id="btnAnaliz" class="btn btn-primary btn-lg text-white" onclick="analyzePrice()">
                            ğŸ¤– Yapay Zeka ile Fiyat Analizi Yap
                        </button>
                    </div>

                    <div id="aiResult" class="alert alert-info mt-4 d-none">
                        <h4 class="alert-heading">ğŸ” AI Tahmini HazÄ±rlanÄ±yor...</h4>
                        <p id="aiMessage">LÃ¼tfen bekleyin, Python servisine baÄŸlanÄ±lÄ±yor...</p>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    async function analyzePrice() {
        const resultDiv = document.getElementById("aiResult");
        const msg = document.getElementById("aiMessage");
        const btn = document.getElementById("btnAnaliz");

        // YÃ¼kleniyor modu
        resultDiv.classList.remove("d-none");
        resultDiv.className = "alert alert-warning mt-4";
        msg.innerText = "â³ Veriler Python Yapay Zeka Servisine gÃ¶nderiliyor...";
        btn.disabled = true;

        try {
            // Basit bir POST isteÄŸi 
            const response = await fetch("http://localhost:5000/predict", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    Marka: "@Model.Brand?.Name",
                    Kategori: "@Model.Category?.Name",
                    Fiyat: @Model.CurrentPrice
                })
            });

            const data = await response.json();

            // Sonucu GÃ¶ster
            resultDiv.className = "alert alert-success mt-4";
            msg.innerHTML = `<strong>âœ… AI Tahmini Geldi:</strong><br>
                             Bu Ã¼rÃ¼nÃ¼n adil piyasa deÄŸeri: <strong>${data.tahmin} TL</strong><br>
                             Durum: <strong>${data.durum || "Analiz TamamlandÄ±"}</strong>`;
        } catch (error) {
            resultDiv.className = "alert alert-danger mt-4";
            msg.innerText = "âŒ Hata: Python API'sine ulaÅŸÄ±lamadÄ±.";
        } finally {
            btn.disabled = false;
        }
    }
</script>